(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2a685a40"],{"466d":function(e,a,t){"use strict";var s=t("d784"),r=t("825a"),o=t("50c4"),l=t("1d80"),n=t("8aa5"),i=t("14c3");s("match",1,(function(e,a,t){return[function(a){var t=l(this),s=void 0==a?void 0:a[e];return void 0!==s?s.call(a,t):new RegExp(a)[e](String(t))},function(e){var s=t(a,e,this);if(s.done)return s.value;var l=r(e),c=String(this);if(!l.global)return i(l,c);var u=l.unicode;l.lastIndex=0;var m,p=[],d=0;while(null!==(m=i(l,c))){var h=String(m[0]);p[d]=h,""===h&&(l.lastIndex=n(c,o(l.lastIndex),u)),d++}return 0===d?null:p}]}))},"4a5b":function(e,a,t){"use strict";t.r(a);var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"schedule-container"},[t("el-container",[t("el-header",[t("el-row",{attrs:{gutter:24,align:"middle",type:"flex"}},[t("el-col",{attrs:{span:5}},[t("el-button-group",[t("el-button",{on:{click:function(a){e.queryFormShow=!0}}},[e._v("查询课表")]),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",disabled:"scheduled_classroom"===e.confirmForm.value,content:"仅允许对教室课表进行排课",placement:"top-start"}},[t("div",{staticStyle:{display:"inline-block"}},[t("el-button",{style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},attrs:{type:e.paikeStatus?"info":"primary",disabled:"scheduled_classroom"!==e.confirmForm.value&&"disabled"},on:{click:e.changePaikeStatus}},[e._v(e._s(e.paikeStatus?"退出排课":"开始排课"))])],1)])],1)],1),t("el-col",{attrs:{span:3}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",disabled:!!e.confirmForm.input,content:"请先查询课表",placement:"top-start"}},[t("div",{staticStyle:{display:"inline-block"}},[t("el-button",{attrs:{disabled:!e.confirmForm.input,type:"primary"},on:{click:e.exportSchedule}},[e._v("导出课表")])],1)])],1),t("el-col",{attrs:{span:8}},[e._v(" 周数："),t("el-input-number",{attrs:{min:1,max:22},on:{change:e.searchByWeek},model:{value:e.week,callback:function(a){e.week=a},expression:"week"}})],1),t("el-col",{attrs:{span:8}},[e.confirmForm.input?t("div",[t("span",{staticClass:"identify"},[e._v(e._s(e.confirmForm.input))]),t("span",[e._v(e._s(e.identify))])]):e._e()])],1)],1),t("el-main",[t("el-table",{key:Date.now(),staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","header-cell-style":{textAlign:"center"},"cell-style":e.isPaike,"cell-class-name":e.isCellHover},on:{"cell-click":e.paike}},[t("el-table-column",{attrs:{prop:"time",label:"课时",width:"180"}}),t("el-table-column",{attrs:{prop:"周1",label:"周一"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.hasProps(a)?[t("p",[t("i",{staticClass:"fa fa-book",attrs:{"aria-hidden":"true"}}),e._v(" "+e._s(e.takeCourse(a)))]),"teacher_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeTeacherName(a)))]):e._e(),"classes_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassName(a)))]):e._e(),"scheduled_classroom"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassroom(a)))]):e._e()]:e._e()]}}])}),t("el-table-column",{attrs:{prop:"周2",label:"周二"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.hasProps(a)?[t("p",[t("i",{staticClass:"fa fa-book",attrs:{"aria-hidden":"true"}}),e._v(" "+e._s(e.takeCourse(a)))]),"teacher_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeTeacherName(a)))]):e._e(),"classes_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassName(a)))]):e._e(),"scheduled_classroom"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassroom(a)))]):e._e()]:e._e()]}}])}),t("el-table-column",{attrs:{prop:"周3",label:"周三"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.hasProps(a)?[t("p",[t("i",{staticClass:"fa fa-book",attrs:{"aria-hidden":"true"}}),e._v(" "+e._s(e.takeCourse(a)))]),"teacher_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeTeacherName(a)))]):e._e(),"classes_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassName(a)))]):e._e(),"scheduled_classroom"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassroom(a)))]):e._e()]:e._e()]}}])}),t("el-table-column",{attrs:{prop:"周4",label:"周四"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.hasProps(a)?[t("p",[t("i",{staticClass:"fa fa-book",attrs:{"aria-hidden":"true"}}),e._v(" "+e._s(e.takeCourse(a)))]),"teacher_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeTeacherName(a)))]):e._e(),"classes_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassName(a)))]):e._e(),"scheduled_classroom"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassroom(a)))]):e._e()]:e._e()]}}])}),t("el-table-column",{attrs:{prop:"周5",label:"周五"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.hasProps(a)?[t("p",[t("i",{staticClass:"fa fa-book",attrs:{"aria-hidden":"true"}}),e._v(" "+e._s(e.takeCourse(a)))]),"teacher_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeTeacherName(a)))]):e._e(),"classes_name"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassName(a)))]):e._e(),"scheduled_classroom"!==e.confirmForm.value?t("p",[e._v(e._s(e.takeClassroom(a)))]):e._e()]:e._e()]}}])})],1)],1)],1),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"查询课表",visible:e.queryFormShow,width:"350px",center:!0},on:{"update:visible":function(a){e.queryFormShow=a}}},[t("el-form",{attrs:{model:e.queryForm,"label-position":"left"}},[t("el-form-item",{attrs:{label:"查询类型","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(a){e.queryForm.input=""}},model:{value:e.queryForm.value,callback:function(a){e.$set(e.queryForm,"value",a)},expression:"queryForm.value"}},e._l(e.query_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"查询内容","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"请选择",filterable:""},model:{value:e.queryForm.input,callback:function(a){e.$set(e.queryForm,"input",a)},expression:"queryForm.input"}},e._l(e.current_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelForm}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.searchInfo}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"排课",visible:e.paikeFormShow,width:"350px",center:!0},on:{"update:visible":function(a){e.paikeFormShow=a}}},[t("el-form",{ref:"paikeForm",attrs:{model:e.paikeForm,"label-position":"left",rules:e.rules}},[t("el-form-item",{attrs:{label:"课程名","label-width":e.formLabelWidth,prop:"course_name"}},[t("el-select",{attrs:{placeholder:"请选择",filterable:""},model:{value:e.paikeForm.course_name,callback:function(a){e.$set(e.paikeForm,"course_name",a)},expression:"paikeForm.course_name"}},e._l(e.course_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"班级名","label-width":e.formLabelWidth,prop:"classes_name"}},[t("el-select",{attrs:{placeholder:"请选择",filterable:""},model:{value:e.paikeForm.classes_name,callback:function(a){e.$set(e.paikeForm,"classes_name",a)},expression:"paikeForm.classes_name"}},e._l(e.class_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"教师名","label-width":e.formLabelWidth,prop:"teacher_name"}},[t("el-select",{attrs:{placeholder:"请选择",filterable:""},model:{value:e.paikeForm.teacher_name,callback:function(a){e.$set(e.paikeForm,"teacher_name",a)},expression:"paikeForm.teacher_name"}},e._l(e.teacher_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"时间段","label-width":e.formLabelWidth,prop:"number_sections"}},[e.section?t("el-select",{attrs:{value:e.paikeForm.number_sections,disabled:""}},e._l(e.section_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):t("el-select",{attrs:{placeholder:"请选择",filterable:""},model:{value:e.paikeForm.number_sections,callback:function(a){e.$set(e.paikeForm,"number_sections",a)},expression:"paikeForm.number_sections"}},e._l(e.section_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"工作日","label-width":e.formLabelWidth,prop:"weeks"}},[e.section?t("el-select",{attrs:{value:e.paikeForm.weeks,disabled:""}},e._l(e.week_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):t("el-select",{attrs:{placeholder:"请选择",filterable:""},model:{value:e.paikeForm.weeks,callback:function(a){e.$set(e.paikeForm,"weeks",a)},expression:"paikeForm.weeks"}},e._l(e.week_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelForm}},[e._v("取 消")]),e.cancelBtnShow?t("el-button",{attrs:{type:"warning"},on:{click:e.cancelPaike}},[e._v("取消排课")]):e._e(),t("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.confirmPaike("paikeForm")}}},[e._v("确 定")])],1)],1)],1)},r=[],o=(t("159b"),t("99af"),t("4de4"),t("d3b7"),t("25f0"),t("caad"),t("2532"),t("ac1f"),t("1276"),t("fb6a"),t("466d"),{data:function(){return{scheduleList:[],formLabelWidth:"80px",paikeStatus:!1,week:1,queryFormShow:!1,paikeFormShow:!1,cancelBtnShow:!1,tableData:[],classroom_options:[],course_options:[],teacher_options:[],class_options:[],queryForm:{value:"classes_name",input:""},confirmForm:{value:"classes_name",input:""},paikeForm:{schedule_id:"",class_weeks:"",classes_name:"",course_name:"",number_sections:"",scheduled_classroom:"",teacher_name:"",weeks:""},query_options:[{value:"classes_name",label:"根据班级查询"},{value:"scheduled_classroom",label:"根据教室查询"},{value:"teacher_name",label:"根据教师查询"}],section_options:[{value:"1、2",label:"第1、2节"},{value:"3、4",label:"第3、4节"},{value:"5、6",label:"第5、6节"},{value:"7、8",label:"第7、8节"},{value:"9、10",label:"第9、10节"},{value:"11、12",label:"第11、12节"}],week_options:[{value:"一",label:"周一"},{value:"二",label:"周二"},{value:"三",label:"周三"},{value:"四",label:"周四"},{value:"五",label:"周五"}],rules:{course_name:[{required:!0,message:"请选择课程名",trigger:"blur"}],classes_name:[{required:!0,message:"请选择班级名",trigger:"blur"}],number_sections:[{required:!0,message:"请选择时间段",trigger:"blur"}],teacher_name:[{required:!0,message:"请选择教师",trigger:"blur"}],weeks:[{required:!0,message:"请选择教师",trigger:"blur"}]}}},computed:{identify:function(){switch(this.confirmForm.value){case"teacher_name":return" 老师的课表";case"scheduled_classroom":return" 课室的课表";default:return" 的课表"}},current_options:function(){var e={teacher_name:"teacher_options",scheduled_classroom:"classroom_options",classes_name:"class_options"};return this[e[this.queryForm.value]]},section:function(){var e=this,a="";return this.section_options.forEach((function(t){t.value===e.paikeForm.number_sections&&(e.paikeForm.schedule_id||(a=t.label))})),a}},created:function(){for(var e=this,a=0;a<6;a++)this.tableData[a]={},this.tableData[a]["time"]="第".concat(2*a+1,"、").concat(2*a+2,"节课");this.$store.dispatch("course/getCourseList").then((function(a){a.forEach((function(a){e.course_options.push({value:a.course_name,label:a.course_name})}))})),this.$store.dispatch("classroom/getClassroomList").then((function(a){a.forEach((function(a){e.classroom_options.push({value:a.classroom_address,label:"".concat(a.classroom_address,"(").concat(a.classroom_name,")")})}))})),this.$store.dispatch("teacher/getTeacherList").then((function(a){var t=a.filter((function(e){return 1!==e.is_delete}));t.forEach((function(a){e.teacher_options.push({value:a.teacher_name,label:a.teacher_name})}))})),this.$store.dispatch("tb_class/getClassList").then((function(a){a.forEach((function(a){e.class_options.push({value:a.class_name,label:a.class_name})}))}))},methods:{searchInfo:function(e,a,t,s){var r=this,o=JSON.parse(JSON.stringify(this.tableData)),l=s||this.queryForm,n=l.value,i=l.input.toString(),c={};c[n]=i;var u={type:n,searchStr:c};""!==i?(this.confirmForm.value=n,this.confirmForm.input=i,this.$store.dispatch("schedule/searchInfo",u).then((function(e){for(var a=e.lists[0]["节数"],t=0;t<a.length;t++)r.generateData(a[t],String(t+1),o);r.tableData=o,r.cancelForm()})),this.queryFormShow=!1):this.$message({type:"warning",message:"未确认查询内容"})},generateData:function(e,a,t){var s=String(this.week);for(var r in e)switch(r){case"第1,2节":t[0]["周"+a]=e[r].filter((function(e){return e.class_weeks.split("、").includes(s)}))[0];break;case"第3,4节":t[1]["周"+a]=e[r].filter((function(e){return e.class_weeks.split("、").includes(s)}))[0];break;case"第5,6节":t[2]["周"+a]=e[r].filter((function(e){return e.class_weeks.split("、").includes(s)}))[0];break;case"第7,8节":t[3]["周"+a]=e[r].filter((function(e){return e.class_weeks.split("、").includes(s)}))[0];break;case"第9,10节":t[4]["周"+a]=e[r].filter((function(e){return e.class_weeks.split("、").includes(s)}))[0];break;case"第11,12节":t[5]["周"+a]=e[r].filter((function(e){return e.class_weeks.split("、").includes(s)}))[0];break}},searchByWeek:function(){this.searchInfo(void 0,void 0,void 0,this.confirmForm)},cancelForm:function(){this.queryFormShow=!1,this.queryForm.input="",this.paikeFormShow=!1,this.paikeForm={schedule_id:"",class_weeks:"",classes_name:"",course_name:"",number_sections:"",scheduled_classroom:"",teacher_name:"",weeks:""}},hasProps:function(e){var a=e.column.property;return!!e.row[a]},takeCourse:function(e){var a=e.column.property;return e.row[a]?e.row[a].course_name:""},takeTeacherName:function(e){var a=e.column.property;return e.row[a]?e.row[a].teacher_name:""},takeClassName:function(e){var a=e.column.property;return e.row[a]?e.row[a].classes_name:""},takeClassroom:function(e){var a=e.column.property;return e.row[a]?e.row[a].scheduled_classroom:""},paike:function(e,a){if(this.paikeStatus)if(this.confirmForm.input){this.paikeFormShow=!0;var t=this.paikeForm,s=/(\d+、\d+)/,r=e[a.property];for(var o in this.cancelBtnShow=!!r,r)t.hasOwnProperty(o)&&(t[o]=r[o]);t.weeks=a.label.slice(1),t.number_sections=e.time.match(s)[0]}else this.$message({type:"warning",message:"未确认查询内容"})},confirmPaike:function(e){var a=this;this.$refs[e].validate((function(e){e&&(a.cancelBtnShow?(a.deleteSchedule(!0),a.addSchedule(!0)):(a.paikeForm.scheduled_classroom=a.confirmForm.input,a.paikeForm.class_weeks=a.week,a.addSchedule(!1)))}))},cancelPaike:function(){var e=this;this.$confirm("确认取消该课程安排?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.deleteSchedule().then((function(a){e.$message({type:"success",message:a})})).catch((function(){e.$message({type:"error",message:"取消排课失败"})}))})).catch((function(){e.$message({type:"info",message:"操作已取消"})}))},addSchedule:function(e){var a=this;this.$store.dispatch("schedule/addSchedule",this.paikeForm).then((function(t){a.$message({type:"success",message:e?"修改成功":"排课成功"}),a.searchInfo(void 0,void 0,void 0,a.confirmForm),a.paikeFormShow=!1,a.cancelForm()}))},deleteSchedule:function(e){var a=this;return new Promise((function(t,s){var r={xiugaizhoushu:a.week,schedule_id:a.paikeForm.schedule_id};a.$store.dispatch("schedule/deleteSchedule",r).then((function(s){t(s),!e&&a.searchInfo(void 0,void 0,void 0,a.confirmForm),a.paikeFormShow=!1,a.cancelForm()}))}))},changePaikeStatus:function(){this.paikeStatus=!this.paikeStatus,!0===this.paikeStatus?this.$message({type:"success",message:"已进入排课状态"}):this.$message({type:"info",message:"已退出排课状态"})},isPaike:function(e){var a=e.columnIndex;return this.paikeStatus&&a>0?{textAlign:"center",cursor:"pointer",background:"#fff"}:{textAlign:"center",background:"#fff"}},isCellHover:function(e){var a=e.columnIndex;return a>0&&this.paikeStatus?"hover":""},exportSchedule:function(){var e={str:this.confirmForm.value,value:this.confirmForm.input};this.$store.dispatch("schedule/exportSchedule",e)}}}),l=o,n=(t("ec0d"),t("2877")),i=Object(n["a"])(l,s,r,!1,null,"a79e1de8",null);a["default"]=i.exports},"7caf":function(e,a,t){},ec0d:function(e,a,t){"use strict";t("7caf")}}]);